{"version":3,"sources":["../src/helpers.js"],"names":["makeConstantsObject","sourceValues","extraOverrides","Object","freeze","generateAsyncOperationKey","descriptorId","params","config","asyncOperationManagerConfig","getConfig","baseAsyncOperationKey","logger","exceptionsCallback","sortedParamValues","forEach","entry","sort","join","getAndValidateParams","paramsToCheck","asyncOperationDescriptor","asyncOperationParams","requiredParams","optionalParams","has","paramValue","keys","getAsyncOperationDescriptor","asyncOperationDescriptors","warningsCallback","debug","verboseLoggingCallback","infoLoggingCallback","getAsyncOperationInfo","descriptors","asyncOperationKey","otherFields"],"mappings":"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","sourcesContent":["// TODO: JSDocify every function\n\nimport {\n  assign,\n  every,\n  keyBy,\n  has,\n  isArray,\n  isEmpty,\n  isString,\n  isUndefined,\n  partial,\n  pick,\n  omit,\n  some,\n  values,\n} from 'lodash';\n\nimport asyncOperationManagerConfig from './config';\n\nconst makeConstantsObject = (sourceValues = [], extraOverrides = {}) =>\n  Object.freeze(\n    // The keyBy create our keys-and-values object, then we manipulate it and freeze it.s\n    assign(keyBy(sourceValues), extraOverrides)\n  );\n\n\nconst generateAsyncOperationKey = (descriptorId, params = {}) => {\n  const config = asyncOperationManagerConfig.getConfig();\n  let baseAsyncOperationKey = descriptorId;\n  if (!descriptorId || !isString(descriptorId)) {\n    config.logger.exceptionsCallback('A descriptorId string to create the async operation key was not provided');\n  }\n\n  if (!isEmpty(params)) {\n    let sortedParamValues = values(params);\n    sortedParamValues.forEach((entry) => {\n      if (isArray(entry)) {\n        entry.sort();\n      }\n    });\n    sortedParamValues.sort();\n    baseAsyncOperationKey = `${baseAsyncOperationKey}_${sortedParamValues.join('_')}`;\n  }\n\n  return baseAsyncOperationKey;\n};\n\nconst getAndValidateParams = (paramsToCheck, asyncOperationDescriptor) => {\n  // Pick out designated required and optional params exclusively.\n  const asyncOperationParams = {\n    ...asyncOperationDescriptor.requiredParams ? pick(paramsToCheck, asyncOperationDescriptor.requiredParams) : {},\n    ...asyncOperationDescriptor.optionalParams ? pick(paramsToCheck, asyncOperationDescriptor.optionalParams) : {},\n  };\n\n  const { logger } = asyncOperationManagerConfig.getConfig();\n  if (asyncOperationDescriptor.requiredParams) {\n    // make sure that every requiredParams is included in the asyncOperationParams object and that\n    // none of the values are undefined\n    if (!every(asyncOperationDescriptor.requiredParams, partial(has, asyncOperationParams)) ||\n      (asyncOperationParams && some(asyncOperationParams, paramValue => isUndefined(paramValue)))) {\n      // This warning is here just to catch typos\n      logger.exceptionsCallback(`\n        It looks like ${asyncOperationDescriptor.descriptorId} is missing a param/requiredParams.\n        requiredParams provided: : ${Object.keys(asyncOperationParams)}\n        requiredParams: : ${asyncOperationDescriptor.requiredParams}\n      `);\n    }\n  }\n\n  return asyncOperationParams;\n};\n\nconst getAsyncOperationDescriptor = (asyncOperationDescriptors, descriptorId) => {\n  const config = asyncOperationManagerConfig.getConfig();\n  const asyncOperationDescriptor = asyncOperationDescriptors[descriptorId];\n\n  if (!asyncOperationDescriptor) {\n    config.logger.warningsCallback(`descriptorId \"${descriptorId}\" does not match with any registered async operation descriptor`);\n    return null;\n  }\n\n  if (asyncOperationDescriptor.debug) {\n    config.logger.verboseLoggingCallback(`Inside getAsyncOperationDescriptor for ${descriptorId}`);\n    config.logger.infoLoggingCallback('getAsyncOperationDescriptor [Data Snapshot]:', {\n      asyncOperationDescriptors,\n      asyncOperationDescriptor,\n    });\n  }\n\n  return asyncOperationDescriptor;\n};\n\nconst getAsyncOperationInfo = (descriptors, descriptorId, params) => {\n  const asyncOperationDescriptor = getAsyncOperationDescriptor(descriptors, descriptorId);\n  const asyncOperationParams = getAndValidateParams(params, asyncOperationDescriptor);\n  const asyncOperationKey = generateAsyncOperationKey(descriptorId, asyncOperationParams);\n  const otherFields = omit(params, asyncOperationDescriptor.requiredParams);\n\n  return {\n    asyncOperationDescriptor,\n    asyncOperationParams,\n    asyncOperationKey,\n    otherFields,\n  };\n};\n\nexport {\n  makeConstantsObject,\n  generateAsyncOperationKey,\n  getAndValidateParams,\n  getAsyncOperationInfo,\n  getAsyncOperationDescriptor,\n};\n"],"file":"helpers.js"}