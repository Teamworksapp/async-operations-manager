{"version":3,"sources":["../../../src/reduxIntegration/__tests__/functional_tests.js"],"names":["describe","state","beforeEach","dateNowStub","jest","fn","global","Date","now","initialAction","beginAction","descriptorId","requiredParams","operationType","personId","it","resolveAction","to","deep","equal","operations","FETCH_PERSON_DATA_111","fetchStatus","FETCH_STATUS","PENDING","dataStatus","DATA_STATUS","ABSENT","message","lastFetchStatusTime","lastDataStatusTime","SUCCESSFUL","PRESENT","lastFetchFailed","rejectAction","include","FAILED","onResolve","orgId","initialFetchCalendarDataAction","beginFetchCalendarDataAction","resolveFetchCalendarDataAction","FETCH_CALENDAR_DATA_22","initialUpdateAppointmentDataAction","appointmentId","beginUpdateAppointmentDataAction","resolveUpdateAppointmentDataAction","UPDATE_APPOINTMENT_DATA_22_111","currentState","fetchCalendarDataAsyncOperation","be","an","matchSnapshot"],"mappings":"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","sourcesContent":["/* eslint-env jest */\nimport { expect } from 'chai';\n\nimport asyncOperationReducer from '../asyncOperationReducer';\n\nimport { FETCH_STATUS, DATA_STATUS } from '../../constants';\n\nimport {\n  createAsyncOperationInitialAction,\n  createAsyncOperationBeginAction,\n  createAsyncOperationResolveAction,\n  createAsyncOperationRejectAction,\n} from '../asyncOperationReduxUtils';\n\nimport {\n  clearAsyncOperationsManagerState,\n  getAsyncOperationsManagerState,\n  registerAsyncOperationDescriptors,\n  invalidateAsyncOperation,\n} from '../../asyncOperationManagerUtils';\n\ndescribe('functional tests', () => {\n  let state;\n\n  beforeEach(() => {\n    clearAsyncOperationsManagerState();\n    const dateNowStub = jest.fn(() => 1530518207007);\n    global.Date.now = dateNowStub;\n  });\n\n  describe('READ operation scenarios', () => {\n    let initialAction;\n    let beginAction;\n    beforeEach(() => {\n      state = {};\n      clearAsyncOperationsManagerState();\n      registerAsyncOperationDescriptors({\n        descriptorId: 'FETCH_PERSON_DATA',\n        requiredParams: ['personId'],\n        operationType: 'READ',\n      });\n      initialAction = createAsyncOperationInitialAction('FETCH_PERSON_DATA', {\n        personId: 111,\n      });\n      beginAction = createAsyncOperationBeginAction('FETCH_PERSON_DATA', {\n        personId: 111,\n      });\n    });\n\n    it('should update a successful READ operation as expected from start to finish', () => {\n      const resolveAction = createAsyncOperationResolveAction('FETCH_PERSON_DATA', {\n        personId: 111,\n      });\n\n      expect(asyncOperationReducer(state, initialAction)).to.deep.equal(state);\n      expect(asyncOperationReducer(state, beginAction).operations).to.deep.equal({\n        FETCH_PERSON_DATA_111: {\n          descriptorId: 'FETCH_PERSON_DATA',\n          fetchStatus: FETCH_STATUS.PENDING,\n          dataStatus: DATA_STATUS.ABSENT,\n          message: null,\n          lastFetchStatusTime: 1530518207007,\n          lastDataStatusTime: 0,\n          personId: 111,\n        },\n      });\n      expect(asyncOperationReducer(state, resolveAction).operations).to.deep.equal({\n        FETCH_PERSON_DATA_111: {\n          descriptorId: 'FETCH_PERSON_DATA',\n          fetchStatus: FETCH_STATUS.SUCCESSFUL,\n          dataStatus: DATA_STATUS.PRESENT,\n          message: null,\n          lastFetchStatusTime: 1530518207007,\n          lastDataStatusTime: 1530518207007,\n          personId: 111,\n          lastFetchFailed: false,\n        },\n      });\n    });\n\n    it('should update a failed READ operation as expected from start to finish', () => {\n      const rejectAction = createAsyncOperationRejectAction('FETCH_PERSON_DATA', {\n        personId: 111,\n      });\n\n      expect(asyncOperationReducer(state, initialAction)).to.deep.equal(state);\n      expect(asyncOperationReducer(state, beginAction).operations).to.deep.include({\n        FETCH_PERSON_DATA_111: {\n          descriptorId: 'FETCH_PERSON_DATA',\n          fetchStatus: FETCH_STATUS.PENDING,\n          dataStatus: DATA_STATUS.ABSENT,\n          message: null,\n          lastFetchStatusTime: 1530518207007,\n          lastDataStatusTime: 0,\n          personId: 111,\n        },\n      });\n      expect(asyncOperationReducer(state, rejectAction).operations).to.deep.include({\n        FETCH_PERSON_DATA_111: {\n          descriptorId: 'FETCH_PERSON_DATA',\n          fetchStatus: FETCH_STATUS.FAILED,\n          dataStatus: DATA_STATUS.ABSENT,\n          message: null,\n          lastFetchStatusTime: 1530518207007,\n          lastDataStatusTime: 0,\n          personId: 111,\n          lastFetchFailed: true,\n        },\n      });\n    });\n  });\n\n  describe('Invalidate operations', () => {\n    beforeEach(() => {\n      state = {};\n      clearAsyncOperationsManagerState();\n    });\n\n    it('should invalidate async operation if another operation descriptor\\'s onResolve invalidates it', () => {\n      registerAsyncOperationDescriptors([\n        {\n          descriptorId: 'UPDATE_APPOINTMENT_DATA',\n          requiredParams: ['orgId', 'appointmentId'],\n          operationType: 'WRITE',\n          onResolve: ({ orgId }) => {\n            invalidateAsyncOperation('FETCH_CALENDAR_DATA', { orgId });\n          },\n        },\n        {\n          descriptorId: 'FETCH_CALENDAR_DATA',\n          requiredParams: ['orgId'],\n          operationType: 'READ',\n        },\n      ]);\n\n      const initialFetchCalendarDataAction = createAsyncOperationInitialAction('FETCH_CALENDAR_DATA', {\n        orgId: 22,\n      });\n      const beginFetchCalendarDataAction = createAsyncOperationBeginAction('FETCH_CALENDAR_DATA', {\n        orgId: 22,\n      });\n      const resolveFetchCalendarDataAction = createAsyncOperationResolveAction('FETCH_CALENDAR_DATA', {\n        orgId: 22,\n      });\n\n      expect(asyncOperationReducer(state, initialFetchCalendarDataAction)).to.deep.equal(state);\n      expect(asyncOperationReducer(state, beginFetchCalendarDataAction).operations).to.deep.include({\n        FETCH_CALENDAR_DATA_22: {\n          descriptorId: 'FETCH_CALENDAR_DATA',\n          fetchStatus: FETCH_STATUS.PENDING,\n          dataStatus: DATA_STATUS.ABSENT,\n          message: null,\n          lastFetchStatusTime: 1530518207007,\n          lastDataStatusTime: 0,\n          orgId: 22,\n        },\n      });\n\n      expect(asyncOperationReducer(state, resolveFetchCalendarDataAction).operations).to.deep.include({\n        FETCH_CALENDAR_DATA_22: {\n          descriptorId: 'FETCH_CALENDAR_DATA',\n          fetchStatus: 'SUCCESSFUL',\n          dataStatus: 'PRESENT',\n          message: null,\n          lastFetchStatusTime: 1530518207007,\n          lastDataStatusTime: 1530518207007,\n          orgId: 22,\n          lastFetchFailed: false,\n        },\n      });\n\n      const dateNowStub = jest.fn(() => 1540000000000);\n      global.Date.now = dateNowStub;\n\n      const initialUpdateAppointmentDataAction = createAsyncOperationInitialAction('UPDATE_APPOINTMENT_DATA', {\n        orgId: 22,\n        appointmentId: 111,\n      });\n      const beginUpdateAppointmentDataAction = createAsyncOperationBeginAction('UPDATE_APPOINTMENT_DATA', {\n        orgId: 22,\n        appointmentId: 111,\n      });\n      const resolveUpdateAppointmentDataAction = createAsyncOperationResolveAction('UPDATE_APPOINTMENT_DATA', {\n        orgId: 22,\n        appointmentId: 111,\n      });\n\n      expect(asyncOperationReducer(state, initialUpdateAppointmentDataAction)).to.deep.equal(state);\n      expect(asyncOperationReducer(state, beginUpdateAppointmentDataAction).operations).to.deep.include({\n        UPDATE_APPOINTMENT_DATA_22_111: {\n          descriptorId: 'UPDATE_APPOINTMENT_DATA',\n          fetchStatus: FETCH_STATUS.PENDING,\n          message: null,\n          lastFetchStatusTime: 1540000000000,\n          orgId: 22,\n          appointmentId: 111,\n        },\n      });\n\n      expect(asyncOperationReducer(state, resolveUpdateAppointmentDataAction).operations).to.deep.include({\n        UPDATE_APPOINTMENT_DATA_22_111: {\n          descriptorId: 'UPDATE_APPOINTMENT_DATA',\n          fetchStatus: 'SUCCESSFUL',\n          message: null,\n          lastFetchStatusTime: 1540000000000,\n          orgId: 22,\n          appointmentId: 111,\n        },\n      });\n\n      const currentState = getAsyncOperationsManagerState();\n\n\n      const fetchCalendarDataAsyncOperation = currentState.operations.FETCH_CALENDAR_DATA_22;\n\n      expect(fetchCalendarDataAsyncOperation).to.be.an('object');\n      expect(fetchCalendarDataAsyncOperation).to.deep.include({\n        lastFetchStatusTime: 0,\n        lastDataStatusTime: 0,\n      });\n      expect(fetchCalendarDataAsyncOperation).to.matchSnapshot('Invalidated read fetchCalendarDataAsyncOperation');\n    });\n  });\n\n  describe('WRITE operation scenarios', () => {\n    beforeEach(() => {\n      state = {};\n      clearAsyncOperationsManagerState();\n    });\n  });\n});\n"],"file":"functional_tests.js"}